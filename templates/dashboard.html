<!DOCTYPE html>
<html lang="en">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<title>Seller Dashboard üå¥</title>

<link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.5.0/css/all.min.css"/>

<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-app-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-auth-compat.js"></script>
<script src="https://www.gstatic.com/firebasejs/9.23.0/firebase-firestore-compat.js"></script>

<style>
body {
  margin:0; font-family:"Segoe UI", Arial; background:linear-gradient(135deg,#a8e6cf,#dcedc1); color:#1B5E20;
}
.container {
  max-width:95%; margin:20px auto; padding:20px; border-radius:16px;
  background:rgba(255,255,255,0.95); box-shadow:0 8px 20px rgba(0,0,0,0.2);
}
.header { display:flex; justify-content:space-between; align-items:center; }
.header h2 { margin:0; font-size:2rem; }
.icon-bar i {
  font-size:22px; color:#fff; padding:10px; border-radius:50%; cursor:pointer; margin-left:10px;
  transition:0.3s; background:#43A047;
}
.icon-bar i.delete { background:#D32F2F; }
.icon-bar i:hover { opacity:0.8; }

h3 { color:#2E7D32; margin-top:15px; }

input, select, button {
  width:100%; padding:10px; margin:6px 0; border-radius:8px;
  border:1px solid #ccc; font-size:1rem;
}
button { background:#43A047; color:white; font-weight:bold; cursor:pointer; }
button:hover { opacity:0.9; }
.collapse-btn { background:#81C784; color:white; margin-top:10px; }

.table-wrapper { overflow-x:auto; margin-top:15px; }
table { width:100%; border-collapse:collapse; }
th, td { padding:10px; border:1px solid #ddd; }
th { background:#C8E6C9; }

.action-icon {
  font-size:18px; cursor:pointer; padding:6px; border-radius:6px; margin-right:8px;
}
.edit { background:#FFA726; color:white; }
.delete { background:#D32F2F; color:white; }

/* ---------------- MODAL ---------------- */
#modal-success {
  position:fixed; top:0; left:0; width:100%; height:100%;
  background:rgba(0,0,0,0.6); display:flex; justify-content:center; align-items:center;
  opacity:0; pointer-events:none; transition:0.3s;
}
#modal-success.show {
  opacity:1; pointer-events:auto;
}
.modal-box {
  background:white; padding:25px; width:80%; max-width:350px; text-align:center;
  border-radius:14px; box-shadow:0 4px 15px rgba(0,0,0,0.3);
  animation: pop 0.25s ease-out;
}
@keyframes pop {
  0% { transform:scale(0.6); }
  100% { transform:scale(1); }
}
.modal-box h2 { color:#2E7D32; margin-bottom:10px; }
.modal-box button {
  background:#43A047; color:white; padding:10px 20px; border-radius:8px; margin-top:10px;
}
</style>
</head>
<body>

<div class="container">
  <div class="header">
    <h2>üå¥ Seller Dashboard</h2>
    <div class="icon-bar">
      <i class="fas fa-sign-out-alt" onclick="logout()" title="Logout"></i>
      <i class="fas fa-trash delete" onclick="deleteAccount()" title="Delete Account"></i>
    </div>
  </div>

  <!-- SELLER INFO -->
  <section>
    <h3>üë§ Seller Info</h3>
    <p>üìù <strong>Name:</strong> <span id="display-name"></span></p>
    <p>üìç <strong>Address:</strong> <span id="display-address"></span></p>
    <p>üìû <strong>Contact:</strong> <span id="display-contact"></span></p>
    <p>üå± <strong>Farm/Nursery:</strong> <span id="display-farm"></span></p>

    <button class="collapse-btn" onclick="toggleEditForm()">‚úèÔ∏è Edit Info</button>
    <div id="edit-info-form" style="display:none;">
      <input id="seller-name-input" placeholder="Name">
      <input id="seller-address-input" placeholder="Address">
      <input id="seller-contact-input" placeholder="Contact">
      <input id="seller-farm-input" placeholder="Farm/Nursery">
      <button onclick="updateSellerInfo()">‚úÖ Update</button>
    </div>
  </section>

  <!-- PRODUCTS -->
  <section>
    <h3>üõí Products</h3>
    <button class="collapse-btn" onclick="toggleProductForm()">‚ûï Add New Product</button>

    <div id="product-form" style="display:none;">
      <select id="product-name">
        <option value="">Select Product</option>
        <option>Baybay Tall Coconut</option>
        <option>Laguna Tall Coconut</option>
        <option>Catigan Dwarf Coconut</option>
        <option>Tacunan Dwarf Coconut</option>
      </select>
      <input id="product-price" type="number" placeholder="Price">
      <input id="product-quantity" type="number" placeholder="Quantity">
      <input id="product-description" placeholder="Description">
      <button onclick="addProduct()">‚úÖ Add Product</button>
    </div>

    <div class="table-wrapper">
      <table id="product-table">
        <thead>
          <tr>
            <th>Product</th><th>Price</th><th>Qty</th><th>Description</th><th>Actions</th>
          </tr>
        </thead>
        <tbody></tbody>
      </table>
    </div>
  </section>
</div>

<!-- SUCCESS MODAL -->
<div id="modal-success">
  <div class="modal-box">
    <h2>Product Added! üéâ</h2>
    <p>The new product has been successfully saved.</p>
    <button onclick="closeModal()">OK</button>
  </div>
</div>

<script>
/* ---------------- FIREBASE ---------------- */
const firebaseConfig = {
  apiKey: "AIzaSyDjsNeExHM1YzGGaAmNrOfOC_TRnTaizZQ",
  authDomain: "coconutproject2-f55ce.firebaseapp.com",
  projectId: "coconutproject2-f55ce",
};
firebase.initializeApp(firebaseConfig);
const auth = firebase.auth();
const db = firebase.firestore();

let sellerId = localStorage.getItem("sellerId");
let sellerData = {};
let products = [];

/* ---------------- AUTH ---------------- */
auth.onAuthStateChanged(async user => {
  if (!user) return window.location.href = "index.html";

  sellerId = user.uid;
  localStorage.setItem("sellerId", sellerId);

  const doc = await db.collection("sellers").doc(sellerId).get();
  sellerData = doc.data();
  displaySellerInfo();
  loadProducts();
});

/* ---------------- DISPLAY INFO ---------------- */
function displaySellerInfo() {
  document.getElementById("display-name").textContent = sellerData.name || "";
  document.getElementById("display-address").textContent = sellerData.address || "";
  document.getElementById("display-contact").textContent = sellerData.contact || "";
  document.getElementById("display-farm").textContent = sellerData.farmName || "";

  document.getElementById("seller-name-input").value = sellerData.name || "";
  document.getElementById("seller-address-input").value = sellerData.address || "";
  document.getElementById("seller-contact-input").value = sellerData.contact || "";
  document.getElementById("seller-farm-input").value = sellerData.farmName || "";
}

/* ---------------- FORMS ---------------- */
function toggleEditForm() {
  const f = document.getElementById("edit-info-form");
  f.style.display = f.style.display === "none" ? "block" : "none";
}
function toggleProductForm() {
  const f = document.getElementById("product-form");
  f.style.display = f.style.display === "none" ? "block" : "none";
}

/* ---------------- UPDATE INFO ---------------- */
function updateSellerInfo() {
  sellerData.name = document.getElementById("seller-name-input").value;
  sellerData.address = document.getElementById("seller-address-input").value;
  sellerData.contact = document.getElementById("seller-contact-input").value;
  sellerData.farmName = document.getElementById("seller-farm-input").value;

  db.collection("sellers").doc(sellerId).set(sellerData)
    .then(() => alert("Info updated!"));
}

/* ---------------- LOAD PRODUCTS ---------------- */
async function loadProducts() {
  const tbody = document.querySelector("#product-table tbody");
  tbody.innerHTML = "";
  products = [];

  const snap = await db.collection("sellers").doc(sellerId).collection("products").get();
  snap.forEach(doc => {
    const p = doc.data();
    p.id = doc.id;
    products.push(p);

    const row = document.createElement("tr");
    row.innerHTML = `
      <td>üå¥ ${p.name}</td>
      <td>‚Ç±${p.price}</td>
      <td>${p.quantity}</td>
      <td>${p.description}</td>
      <td>
        <i class="fas fa-edit action-icon edit" onclick="editProduct('${p.id}')"></i>
        <i class="fas fa-trash action-icon delete" onclick="deleteProduct('${p.id}')"></i>
      </td>
    `;
    tbody.appendChild(row);
  });
}

/* ---------------- ADD PRODUCT (WITH MODAL) ---------------- */
async function addProduct() {
  const name = document.getElementById("product-name").value;
  const price = document.getElementById("product-price").value;
  const qty = document.getElementById("product-quantity").value;
  const desc = document.getElementById("product-description").value;

  if (!name || !price || !qty) {
    alert("Please complete all fields.");
    return;
  }

  await db.collection("sellers").doc(sellerId).collection("products").add({
    name, price, quantity: qty, description: desc
  });

  showModal();
  loadProducts();

  document.getElementById("product-name").value = "";
  document.getElementById("product-price").value = "";
  document.getElementById("product-quantity").value = "";
  document.getElementById("product-description").value = "";
}

/* ---------------- MODAL CONTROL ---------------- */
function showModal() {
  document.getElementById("modal-success").classList.add("show");
}
function closeModal() {
  document.getElementById("modal-success").classList.remove("show");
}

/* ---------------- EDIT / DELETE ---------------- */
function editProduct(id) {
  const p = products.find(x => x.id === id);

  const newName = prompt("Name:", p.name);
  const newPrice = prompt("Price:", p.price);
  const newQty = prompt("Quantity:", p.quantity);
  const newDesc = prompt("Description:", p.description);

  db.collection("sellers").doc(sellerId).collection("products").doc(id)
    .update({ name:newName, price:newPrice, quantity:newQty, description:newDesc })
    .then(loadProducts);
}

function deleteProduct(id) {
  if (!confirm("Delete product?")) return;
  db.collection("sellers").doc(sellerId).collection("products").doc(id)
    .delete().then(loadProducts);
}

/* ---------------- ACCOUNT ---------------- */
function logout() {
  auth.signOut().then(() => {
    localStorage.clear();
    window.location.href = "index.html";
  });
}

function deleteAccount() {
  if (!confirm("Delete your account and all data?")) return;

  db.collection("sellers").doc(sellerId).collection("products").get()
    .then(snap => snap.forEach(doc => doc.ref.delete()))
    .then(() => db.collection("sellers").doc(sellerId).delete())
    .then(() => {
      localStorage.clear();
      window.location.href = "index.html";
    });
}
</script>

</body>
</html>
